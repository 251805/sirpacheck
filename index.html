<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDRRMO & PCC Weather, Traffic & Tide Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7fb;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0066cc;
      color: white;
      padding: 1rem;
    }
    header img { height: 60px; width: auto; }
    header .title { text-align: center; flex-grow: 1; }
    header .title h1 { margin: 0; font-size: 1.8rem; }
    header .title p { margin: 0; font-size: 0.9rem; }
    h2 {
      margin-top: 2rem;
      color: #333;
      text-align: center;
    }
    h2 img { height: 50px; vertical-align: middle; margin-right: 10px; }
    #summary {
      text-align: center;
      margin: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #weather {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .barangay-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .barangay-card h3 { margin: 0 0 0.5rem; color: #0066cc; }
    .tide-info {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #444;
      background: #f0f9ff;
      padding: 0.5rem;
      border-radius: 6px;
    }
    iframe { border-radius: 10px; width: 100%; }
    #traffic {
      padding: 1rem;
      margin: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    /* Hotline Marquee */
    #hotline {
      background: #cc0000;
      color: white;
      padding: 0.5rem;
      font-weight: bold;
      position: fixed;
      bottom: 0;
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }
    #hotline span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    /* Windy + Himawari Layout */
    #map-satellite {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      padding: 1rem;
    }
    #windy, #himawari {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    #satellite-container {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      padding: 1rem;
      text-align: center;
    }
    #satellite-container img {
      width: 100%;
      height: auto;
      display: block;
      margin: auto;
      border-radius: 4px;
    }
    #controls { margin: 1rem 0; }
    button {
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      margin: 0.2rem;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background: #004999; }
    #timelapse-thumbs {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
    }
    #timelapse-thumbs img {
      width: 80px;
      height: auto;
      cursor: pointer;
      border: 2px solid transparent;
    }
    #timelapse-thumbs img.selected { border-color: #0066cc; }
    @media(max-width: 900px) {
      #map-satellite { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/NEW%20Pagbilao%20Command%20Logo.png" alt="Left Logo">
    <div class="title">
      <h1>üå¶ MDRRMO & PCC Weather, Traffic & Tide Dashboard üåä</h1>
      <p>Barangay Weather ‚Ä¢ Traffic ‚Ä¢ PAGASA ‚Ä¢ Tide Updates</p>
    </div>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/mdrrmo%20pag.png" alt="Right Logo">
  </header>

  <h2><img src="https://raw.githubusercontent.com/251805/sirpacheck/main/pag%20logo.png" alt="Pagbilao Logo"> Pagbilao, Quezon Summary</h2>
  <div id="summary">Loading summary weather & tide...</div>

  <h2>üìç Weather by Barangay</h2>
  <div id="weather">Loading weather...</div>

  <h2>üöó Traffic (Maharlika Highway) üöó</h2>
  <div id="traffic">Loading traffic data...</div>

  <h2>üå¨ Windy Map & üõ∞ Himawari Satellite</h2>
    <div id="map-satellite">
    <div id="windy">
     <iframe width="100%" height="600" src="https://embed.windy.com/embed2.html?lat=13.972&lon=121.687&detailLat=13.972&detailLon=121.687&width=650&height=450&zoom=11&level=surface&overlay=wind&product=ecmwf&menu=&message=true&marker=true&calendar=now&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
    </div>
    <div id="himawari">
      <div id="satellite-container">
        <img id="main-sat-image" src="" alt="Latest Himawari Image">
        <p id="sat-message">Loading latest satellite image...</p>
        <div id="controls">
          <button id="playBtn">‚ñ∂ Play</button>
          <button id="pauseBtn">‚è∏ Pause</button>
          <label>Speed:
            <select id="speedSelect">
              <option value="1000">1x (1s)</option>
              <option value="250">4x (0.25s)</option>
            </select>
          </label>
        </div>
       <!-- PAGASA Advisory Link -->
        <p>
          üì¢ <a href="https://www.pagasa.dost.gov.ph/weather/weather-advisory" target="_blank">
          Follow the PAGASA Weather Advisory</a>
        </p>
        <!-- PAGASA Advisory Link -->
        <p>
          üì¢ <a href="https://www.pagasa.dost.gov.ph/tropical-cyclone/severe-weather-bulletin/1" target="_blank">
          Follow the PAGASA Severe Weather Bulletin</a>
        </p>
        <div id="timelapse-thumbs"></div>
      </div>
    </div>
  </div>


  <!-- Hotline Marquee -->
  <div id="hotline">
    <span>üìû HOTLINES ‚Äî MDRRMO: 09186244564 | üöí BUMBERO: 09234424945 | üëÆ PULIS: 09985985764 | üèõ LGU PAGBILAO: (042) 797-0937</span>
  </div>

  <script>
  // === API KEYS ===
  const OWM_KEY = "d77dbc9c66952dae67f86c58ab653dec";
  const TOMTOM_KEY = "AnWOBls5vLcwsWYRDnxX8Qf2UKPKHkHb";

  // === Barangays Data ===
  const PAGBILAO_LAT = 13.9714, PAGBILAO_LON = 121.6869;
  const coastalBarangays = ["Bantigue","Pinagbayanan","Daungan (Poblacion)","Polo Iba.","Polo Ila."];
  const barangays = [
    { name: "A√±ato", lat: 14.0042, lon: 121.6572 },
    { name: "Alupaye", lat: 13.9473, lon: 121.6697 },
    { name: "Antipolo", lat: 13.9868, lon: 121.6648 },
    { name: "Bagumbungan Iba.", lat: 13.9995, lon: 121.6894 },
    { name: "Bagumbungan Ila.", lat: 14.0257, lon: 121.6942 },
    { name: "Bantigue", lat: 13.9396, lon: 121.6944 },
    { name: "Bigo", lat: 13.9948, lon: 121.6485 },
    { name: "Binahaan", lat: 13.9898, lon: 121.7579 },
    { name: "Bukal", lat: 13.9728, lon: 121.6800 },
    { name: "Castillo (Poblacion)", lat: 13.9711, lon: 121.6831 },
    { name: "Daungan (Poblacion)", lat: 13.9683, lon: 121.6888 },
    { name: "Del Carmen (Poblacion)", lat: 13.9685, lon: 121.6856 },
    { name: "Ikirin", lat: 13.9872, lon: 121.6900 },
    { name: "Malicboy Kan.", lat: 13.9689, lon: 121.7685 },
    { name: "Malicboy Sil.", lat: 13.9802, lon: 121.7908 },
    { name: "Mapagong", lat: 13.9679, lon: 121.6798 },
    { name: "Mayhay", lat: 13.9771, lon: 121.6842 },
    { name: "Palsabangon Iba.", lat: 13.9893, lon: 121.7371 },
    { name: "Palsabangon Ila.", lat: 14.0211, lon: 121.7242 },
    { name: "Parang (Poblacion)", lat: 13.9710, lon: 121.6897 },
    { name: "Pinagbayanan", lat: 13.9690, lon: 121.7016 },
    { name: "Polo Iba.", lat: 13.9055, lon: 121.7496 },
    { name: "Polo Ila.", lat: 13.9313, lon: 121.7753 },
    { name: "Sta. Catalina (Poblacion)", lat: 13.9711, lon: 121.6868 },
    { name: "Talipan", lat: 13.9628, lon: 121.6537 },
    { name: "Tambak (Poblacion)", lat: 13.9729, lon: 121.6884 },
    { name: "Tukalan", lat: 14.0063, lon: 121.6754 }
  ];

  // === Weather Functions ===
  async function fetchWeather(lat, lon) {
    try {
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OWM_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      if (data.cod === 200) {
        return `
          <p>üå° ${data.main.temp}¬∞C (feels like ${data.main.feels_like}¬∞C)</p>
          <p>üíß Humidity: ${data.main.humidity}%</p>
          <p>üí® Wind: ${data.wind.speed} m/s</p>
          <p>‚òÅÔ∏è Clouds: ${data.clouds.all}%</p>
          <p>üåß Rain: ${(data.rain ? data.rain["1h"] : 0)} mm (1h)</p>
        `;
      }
      return `<p>‚ö†Ô∏è Weather not available</p>`;
    } catch {
      return `<p>‚ùå Error fetching weather</p>`;
    }
  }

  async function fetchTide() {
    return `
      <p>üåä High Tide: 1.8m at 03:20 AM</p>
      <p>üåä Low Tide: 0.3m at 10:45 AM</p>
      <p>üìä <a href="https://www.tide-forecast.com/locations/Pagbilao/tides/latest" target="_blank">View Full Tide Chart</a></p>
    `;
  }

  async function loadSummary() {
    const weather = await fetchWeather(PAGBILAO_LAT, PAGBILAO_LON);
    const tide = await fetchTide();
    document.getElementById("summary").innerHTML = weather + tide;
  }

  async function loadWeather() {
    const container = document.getElementById("weather");
    container.innerHTML = "";
    const results = await Promise.all(barangays.map(async b => {
      const w = await fetchWeather(b.lat, b.lon);
      let tideInfo = "";
      if (coastalBarangays.includes(b.name)) {
        tideInfo = `
          <div class="tide-info">
            üåä High Tide: 1.8m at 03:20 AM<br>
            üåä Low Tide: 0.3m at 10:45 AM<br>
            üìä <a href="https://www.tide-forecast.com/locations/Pagbilao/tides/latest" target="_blank">View Full Tide Chart</a>
          </div>
        `;
      }
      return `<div class="barangay-card"><h3>${b.name}</h3>${w}${tideInfo}</div>`;
    }));
    container.innerHTML = results.join("");
  }

  async function loadTraffic() {
    try {
      const url = `https://api.tomtom.com/traffic/services/4/flowSegmentData/absolute/10/json?point=13.972,121.687&key=${TOMTOM_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      if (data.flowSegmentData) {
        document.getElementById("traffic").innerHTML = `
          <p>üöô Current Speed: ${data.flowSegmentData.currentSpeed} km/h</p>
          <p>üõ£ Free Flow: ${data.flowSegmentData.freeFlowSpeed} km/h</p>
        `;
      } else {
        document.getElementById("traffic").innerText = "‚ö†Ô∏è Traffic data unavailable.";
      }
    } catch {
      document.getElementById("traffic").innerText = "‚ùå Error loading traffic.";
    }
  }

  // === Himawari Animation ===
const BASE_SAT_URL = "https://src.meteopilipinas.gov.ph/repo/mtsat-colored/24hour/";
const TIMELAPSE_COUNT = 24;   // still 24 frames for animation
const THUMB_COUNT = 6;        // only 6 thumbnails displayed
const mainImg = document.getElementById("main-sat-image");
const msg = document.getElementById("sat-message");
const thumbsDiv = document.getElementById("timelapse-thumbs");
const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
const speedSelect = document.getElementById("speedSelect");

let images = [], currentIndex = 0, animTimer = null, frameDelay = parseInt(speedSelect.value);

function loadLatestSatellite() {
  const latestUrl = BASE_SAT_URL + "1-him-colored.png?t=" + Date.now();
  mainImg.src = latestUrl;
  mainImg.onerror = () => { msg.textContent = "‚ö†Ô∏è Satellite image unavailable."; };
  mainImg.onload = () => { msg.textContent = ""; };
}

function buildTimelapse() {
  thumbsDiv.innerHTML = "";
  images = [];

  // Load all 24 frames for animation
  for (let i = 1; i <= TIMELAPSE_COUNT; i++) {
    const url = BASE_SAT_URL + i + "-him-colored.png?t=" + Date.now();
    images.push(url);
  }

  // Pick 6 evenly spaced frames for thumbnails
  const step = Math.floor(TIMELAPSE_COUNT / THUMB_COUNT);
  for (let j = 0; j < THUMB_COUNT; j++) {
    const frameIndex = j * step;
    const imgThumb = document.createElement("img");
    imgThumb.src = images[frameIndex];
    imgThumb.alt = "Frame " + frameIndex;
    imgThumb.addEventListener("click", () => showFrame(frameIndex));
    thumbsDiv.append(imgThumb);
  }

  showFrame(0);
}

function showFrame(i) {
  currentIndex = i;
  mainImg.src = images[i];
  Array.from(thumbsDiv.children).forEach(c => c.classList.remove("selected"));
  // Highlight nearest thumbnail if clicked from play loop
  const nearestThumb = [...thumbsDiv.children].find(
    (c, idx) => Math.abs(idx * Math.floor(TIMELAPSE_COUNT / THUMB_COUNT) - i) < Math.floor(TIMELAPSE_COUNT / THUMB_COUNT)
  );
  if (nearestThumb) nearestThumb.classList.add("selected");
}

function playAnimation() {
  if (animTimer) return;
  animTimer = setInterval(() => {
    currentIndex = (currentIndex + 1) % images.length;
    showFrame(currentIndex);
  }, frameDelay);
}

function pauseAnimation() { clearInterval(animTimer); animTimer = null; }

speedSelect.addEventListener("change", () => {
  frameDelay = parseInt(speedSelect.value);
  if (animTimer) { pauseAnimation(); playAnimation(); }
});
playBtn.addEventListener("click", playAnimation);
pauseBtn.addEventListener("click", pauseAnimation);

// === INIT LOAD ===
loadSummary();
loadWeather();
loadTraffic();
loadLatestSatellite();
buildTimelapse();
setInterval(() => { loadSummary(); loadWeather(); }, 4*60*60*1000);
setInterval(() => { loadLatestSatellite(); buildTimelapse(); }, 10*60*1000);

  </script>
</body>
</html>

 

