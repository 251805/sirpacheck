<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDRRMO & PCC Weather, Traffic & Tide Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7fb;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0066cc;
      color: white;
      padding: 1rem;
    }
    header img { height: 60px; width: auto; }
    header .title { text-align: center; flex-grow: 1; }
    header .title h1 { margin: 0; font-size: 1.8rem; }
    header .title p { margin: 0; font-size: 0.9rem; }
    h2 {
      margin-top: 2rem;
      color: #333;
      text-align: center;
    }
    h2 img { height: 50px; vertical-align: middle; margin-right: 10px; }
    #summary {
      text-align: center;
      margin: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #weather {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .barangay-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .barangay-card h3 { margin: 0 0 0.5rem; color: #0066cc; }
    .tide-info {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #444;
      background: #f0f9ff;
      padding: 0.5rem;
      border-radius: 6px;
    }
    iframe { border-radius: 10px; }
    #traffic {
      padding: 1rem;
      margin: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    /* Side-by-side layout */
    .map-sat-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem;
    }
    #windy, #himawari {
      flex: 1;
      min-width: 350px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }

    /* Hotline Marquee */
    #hotline {
      background: #cc0000;
      color: white;
      padding: 0.5rem;
      font-weight: bold;
      position: fixed;
      bottom: 0;
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }
    #hotline span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* Himawari Timelapse */
    #satellite-container {
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      padding: 0.5rem;
      text-align: center;
    }
    #satellite-container img {
      width: 100%;
      height: auto;
      display: block;
      margin: auto;
      border-radius: 4px;
    }
    #controls { margin: 0.5rem 0; }
    button {
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      margin: 0.2rem;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background: #004999; }
    #timelapse-thumbs {
      margin-top: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.3rem;
    }
    #timelapse-thumbs img {
      width: 60px;
      height: auto;
      cursor: pointer;
      border: 2px solid transparent;
    }
    #timelapse-thumbs img.selected { border-color: #0066cc; }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/NEW%20Pagbilao%20Command%20Logo.png" alt="Left Logo">
    <div class="title">
      <h1>üå¶ MDRRMO & PCC Weather, Traffic & Tide Dashboard üåä</h1>
      <p>Barangay Weather ‚Ä¢ Traffic ‚Ä¢ PAGASA ‚Ä¢ Tide Updates</p>
    </div>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/mdrrmo%20pag.png" alt="Right Logo">
  </header>

  <h2><img src="https://raw.githubusercontent.com/251805/sirpacheck/main/pag%20logo.png" alt="Pagbilao Logo"> Pagbilao, Quezon Summary</h2>
  <div id="summary">Loading summary weather & tide...</div>

  <h2>üìç Weather by Barangay</h2>
  <div id="weather">Loading weather...</div>

  <h2>üöó Traffic (Maharlika Highway) üöó</h2>
  <div id="traffic">Loading traffic data...</div>

  <h2>üå¨ Windy Map & üõ∞ Himawari Satellite Timelapse</h2>
  <div class="map-sat-container">
    <div id="windy">
      <iframe width="100%" height="500" src="https://embed.windy.com/embed2.html?lat=13.972&lon=121.687&detailLat=13.972&detailLon=121.687&width=650&height=450&zoom=11&level=surface&overlay=wind&product=ecmwf&menu=&message=true&marker=true&calendar=now&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
    </div>

    <div id="himawari">
      <div id="satellite-container">
        <img id="main-sat-image" src="" alt="Latest Himawari Image">
        <p id="sat-message">Loading latest satellite image...</p>
        <div id="controls">
          <button id="playBtn">‚ñ∂ Play</button>
          <button id="pauseBtn">‚è∏ Pause</button>
          <label>Speed:
            <select id="speedSelect">
              <option value="1000">1x (1s)</option>
              <option value="500">2x (0.5s)</option>
              <option value="250">4x (0.25s)</option>
            </select>
          </label>
        </div>
        <div id="timelapse-thumbs"></div>
      </div>
    </div>
  </div>

  <!-- Hotline Marquee -->
  <div id="hotline">
    <span>üìû HOTLINES ‚Äî MDRRMO: 09186244564 | üöí BUMBERO: 09234424945 | üëÆ PULIS: 09985985764 | üèõ LGU PAGBILAO: (042) 797-0937</span>
  </div>

  <script>
  const BASE_SAT_URL = "https://src.meteopilipinas.gov.ph/repo/mtsat-colored/24hour/";
  const TIMELAPSE_COUNT = 24;
  const mainImg = document.getElementById("main-sat-image");
  const msg = document.getElementById("sat-message");
  const thumbsDiv = document.getElementById("timelapse-thumbs");
  const playBtn = document.getElementById("playBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const speedSelect = document.getElementById("speedSelect");

  let images = [], currentIndex = 0, animTimer = null, frameDelay = parseInt(speedSelect.value);

  function loadLatestSatellite() {
    const latestUrl = BASE_SAT_URL + "1-him-colored.png?t=" + Date.now();
    mainImg.src = latestUrl;
    mainImg.onerror = () => { msg.textContent = "‚ö†Ô∏è Satellite image unavailable."; };
    mainImg.onload = () => { msg.textContent = ""; };
  }

  function buildTimelapse() {
    thumbsDiv.innerHTML = "";
    images = [];
    for (let i = 0; i < TIMELAPSE_COUNT; i++) {
      const url = BASE_SAT_URL + i + "-him-colored.png?t=" + Date.now();
      images.push(url);
      const imgThumb = document.createElement("img");
      imgThumb.src = url;
      imgThumb.alt = "Frame " + i;
      imgThumb.addEventListener("click", () => showFrame(i));
      thumbsDiv.append(imgThumb);
    }
    showFrame(0);
  }

  function showFrame(i) {
    currentIndex = i;
    mainImg.src = images[i];
    Array.from(thumbsDiv.children).forEach(c => c.classList.remove("selected"));
    if (thumbsDiv.children[i]) thumbsDiv.children[i].classList.add("selected");
  }

  function playAnimation() {
    if (animTimer) return;
    animTimer = setInterval(() => {
      currentIndex = (currentIndex + 1) % images.length;
      showFrame(currentIndex);
    }, frameDelay);
  }

  function pauseAnimation() { clearInterval(animTimer); animTimer = null; }

  speedSelect.addEventListener("change", () => {
    frameDelay = parseInt(speedSelect.value);
    if (animTimer) { pauseAnimation(); playAnimation(); }
  });
  playBtn.addEventListener("click", playAnimation);
  pauseBtn.addEventListener("click", pauseAnimation);

  loadLatestSatellite();
  buildTimelapse();
  setInterval(() => { loadLatestSatellite(); buildTimelapse(); }, 10*60*1000);
  </script>
</body>
</html>
