<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDRRMO & PCC Weather, Traffic & Tide Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7fb;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0066cc;
      color: white;
      padding: 1rem;
    }
    header img {
      height: 60px;
      width: auto;
    }
    header .title {
      text-align: center;
      flex-grow: 1;
    }
    header .title h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header .title p {
      margin: 0;
      font-size: 0.9rem;
    }
    h2 {
      margin-top: 2rem;
      color: #333;
      text-align: center;
    }
    #summary {
      text-align: center;
      margin: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #weather {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .barangay-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .barangay-card h3 {
      margin: 0 0 0.5rem 0;
      color: #0066cc;
    }
    .tide-info {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #444;
    }
    iframe {
      border-radius: 10px;
    }
    #traffic, #windy, #pagasa-video {
      padding: 1rem;
      margin: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    /* Hotline Marquee */
    #hotline {
      background: #cc0000;
      color: white;
      padding: 0.5rem;
      font-weight: bold;
      position: fixed;
      bottom: 0;
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }
    #hotline span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/NEW%20Pagbilao%20Command%20Logo.png" alt="Left Logo">
    <div class="title">
      <h1>ğŸŒ¦ MDRRMO & PCC Weather, Traffic & Tide Dashboard ğŸŒŠ</h1>
      <p>Barangay Weather â€¢ Traffic â€¢ PAGASA â€¢ Tide Updates</p>
    </div>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/mdrrmo%20pag.png" alt="Right Logo">
  </header>

  <h2>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/pag%20logo.png" style="height:60px;vertical-align:middle;"> 
    Pagbilao, Quezon Summary
  </h2>
  <div id="summary">Loading summary weather & tide...</div>

  <h2>ğŸ“ Weather by Barangay</h2>
  <div id="weather">Loading weather...</div>

  <h2>ğŸš— Traffic (Maharlika Highway) ğŸš—</h2>
  <div id="traffic">Loading traffic data...</div>

  <h2>ğŸŒ¬ Windy Map ğŸŒ¬</h2>
  <div id="windy">
    <iframe width="100%" height="600" src="https://embed.windy.com/embed2.html?lat=13.972&lon=121.687&zoom=12&level=surface&overlay=wind" frameborder="0"></iframe>
  </div>

  <h2>ğŸ“º Latest PAGASA Forecast Video ğŸ“º</h2>
  <div id="pagasa-video">
    <p>Loading latest PAGASA forecast video...</p>
  </div>

  <!-- Hotline Marquee -->
  <div id="hotline">
    <span>ğŸ“ HOTLINES â€” MDRRMO: 09186244564 | ğŸš’ BUMBERO: 09234424945 | ğŸ‘® PULIS: 09985985764 | ğŸ› LGU PAGBILAO: (042) 797-0937</span>
  </div>

  <script>
  const OWM_KEY = "d77dbc9c66952dae67f86c58ab653dec";
  const TOMTOM_KEY = "AnWOBls5vLcwsWYRDnxX8Qf2UKPKHkHb";
  const YT_KEY = "AIzaSyAdfwN8_02GUGXTW-cnICzYvWYt1etG4JM";
  const CHANNEL_ID = "UCpyLikj1x70S8UPxVqsPr6g"; 
  const TIDE_API = "YOUR_WORLDTIDES_KEY"; // âš ï¸ Replace with valid key

  const PAGBILAO_LAT = 13.9714, PAGBILAO_LON = 121.6869;
  const coastalBarangays = ["Bantigue", "Pinagbayanan", "Daungan (Poblacion)", "Polo Iba.", "Polo Ila."];

  const barangays = [
    { name: "Bantigue", lat: 13.9396, lon: 121.6944 },
    { name: "Daungan (Poblacion)", lat: 13.9683, lon: 121.6888 },
    { name: "Pinagbayanan", lat: 13.9690, lon: 121.7016 },
    { name: "Polo Iba.", lat: 13.9055, lon: 121.7496 },
    { name: "Polo Ila.", lat: 13.9313, lon: 121.7753 },
    { name: "Other Barangays (Summary only)", lat: 13.9714, lon: 121.6869 }
  ];

  async function fetchWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OWM_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.cod === 200) {
        return `
          <p>ğŸŒ¡ ${data.main.temp}Â°C (feels like ${data.main.feels_like}Â°C)</p>
          <p>ğŸ’§ Humidity: ${data.main.humidity}%</p>
          <p>ğŸ’¨ Wind: ${data.wind.speed} m/s</p>
          <p>â˜ï¸ Clouds: ${data.clouds.all}%</p>
          <p>ğŸŒ§ Rain: ${(data.rain ? data.rain["1h"] : 0)} mm (1h)</p>
        `;
      } else {
        return `<p>âš ï¸ Weather not available</p>`;
      }
    } catch {
      return `<p>âŒ Error fetching weather</p>`;
    }
  }

  async function fetchTide(lat, lon) {
    const url = `https://www.worldtides.info/api/v2?extremes&lat=${lat}&lon=${lon}&days=1&key=${TIDE_API}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.extremes) {
        return data.extremes.slice(0, 2).map(t => {
          let time = new Date(t.dt * 1000).toLocaleTimeString();
          return `ğŸŒŠ ${t.type}: ${t.height.toFixed(2)}m at ${time}`;
        }).join("<br>");
      } else {
        return "âš ï¸ Tide data unavailable";
      }
    } catch {
      return "âŒ Error fetching tide";
    }
  }

  async function loadSummary() {
    const weather = await fetchWeather(PAGBILAO_LAT, PAGBILAO_LON);
    const tide = await fetchTide(PAGBILAO_LAT, PAGBILAO_LON);
    document.getElementById("summary").innerHTML = weather + `<p>${tide}</p>`;
  }

  async function loadWeather() {
    const container = document.getElementById("weather");
    container.innerHTML = "";
    const results = await Promise.all(barangays.map(async b => {
      const w = await fetchWeather(b.lat, b.lon);
      let tideInfo = "";
      if (coastalBarangays.includes(b.name)) {
        tideInfo = `<div class="tide-info">${await fetchTide(b.lat, b.lon)}</div>`;
      }
      return `<div class="barangay-card"><h3>${b.name}</h3>${w}${tideInfo}</div>`;
    }));
    container.innerHTML = results.join("");
  }

  async function loadTraffic() {
    const url = `https://api.tomtom.com/traffic/services/4/flowSegmentData/absolute/10/json?point=${PAGBILAO_LAT},${PAGBILAO_LON}&key=${TOMTOM_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.flowSegmentData) {
        document.getElementById("traffic").innerHTML = `
          <p>ğŸš™ Current Speed: ${data.flowSegmentData.currentSpeed} km/h</p>
          <p>ğŸ›£ Free Flow: ${data.flowSegmentData.freeFlowSpeed} km/h</p>
        `;
      } else {
        document.getElementById("traffic").innerText = "âš ï¸ Traffic data unavailable.";
      }
    } catch {
      document.getElementById("traffic").innerText = "âŒ Error loading traffic.";
    }
  }

  async function loadPagasaVideo() {
    try {
      let url = `https://www.googleapis.com/youtube/v3/search?key=${YT_KEY}&channelId=${CHANNEL_ID}&part=snippet&order=date&maxResults=1&type=video`;
      let res = await fetch(url);
      let data = await res.json();
      if (data.items && data.items.length > 0) {
        const video = data.items[0];
        const videoId = video.id.videoId;
        const title = video.snippet.title;
        const published = new Date(video.snippet.publishedAt).toLocaleString();
        document.getElementById("pagasa-video").innerHTML = `
          <h3>${title}</h3>
          <p>ğŸ“… Published: ${published}</p>
          <iframe width="100%" height="350"
            src="https://www.youtube.com/embed/${videoId}"
            frameborder="0" allowfullscreen>
          </iframe>
        `;
      }
    } catch {
      document.getElementById("pagasa-video").innerText = "âŒ Error loading PAGASA video.";
    }
  }

  loadSummary();
  loadWeather();
  loadTraffic();
  loadPagasaVideo();
  setInterval(() => { loadSummary(); loadWeather(); }, 4 * 60 * 60 * 1000);
  </script>
</body>
</html>
