<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDRRMO & PCC Weather, Traffic & Tide Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7fb;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0066cc;
      color: white;
      padding: 1rem;
    }
    header img {
      height: 60px;
      width: auto;
    }
    header .title {
      text-align: center;
      flex-grow: 1;
    }
    header .title h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header .title p {
      margin: 0;
      font-size: 0.9rem;
    }
    h2 {
      margin-top: 2rem;
      color: #333;
      text-align: center;
    }
    h2 img {
      height: 50px;
      width: auto;
      vertical-align: middle;
      margin-right: 10px;
    }
    #summary {
      text-align: center;
      margin: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #summary img {
      height: 70px;
      display: block;
      margin: 0 auto 10px auto;
    }
    #weather {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .barangay-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
    }
    .barangay-card h3 {
      margin: 0 0 0.5rem 0;
      color: #0066cc;
    }
    .tide-info {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #444;
      background: #f0f9ff;
      padding: 0.5rem;
      border-radius: 6px;
    }
    iframe {
      border-radius: 10px;
    }
    #traffic, #windy, #pagasa-video {
      padding: 1rem;
      margin: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    /* Hotline Marquee */
    #hotline {
      background: #cc0000;
      color: white;
      padding: 0.5rem;
      font-weight: bold;
      position: fixed;
      bottom: 0;
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }
    #hotline span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }
    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/NEW%20Pagbilao%20Command%20Logo.png" alt="Left Logo">
    <div class="title">
      <h1>🌦 MDRRMO & PCC Weather, Traffic & Tide Dashboard 🌊</h1>
      <p>Barangay Weather • Traffic • PAGASA • Tide Updates</p>
    </div>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/mdrrmo%20pag.png" alt="Right Logo">
  </header>

  <h2>
    <img src="https://raw.githubusercontent.com/251805/sirpacheck/main/pag%20logo.png" alt="Pagbilao Logo">
    Pagbilao, Quezon Summary
  </h2>
  <div id="summary">Loading summary weather & tide...</div>

  <h2>📍 Weather by Barangay</h2>
  <div id="weather">Loading weather...</div>

  <h2>🚗 Traffic (Maharlika Highway) 🚗</h2>
  <div id="traffic">Loading traffic data...</div>

  <h2>🌬 Windy Map 🌬</h2>
  <div id="windy">
<iframe width="100%" height="800" src="https://embed.windy.com/embed2.html?lat=13.972&lon=121.687&detailLat=13.972&detailLon=121.687&width=650&height=450&zoom=11&level=surface&overlay=wind&product=ecmwf&menu=&message=true&marker=true&calendar=now&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
  </div>

  <h2>📺 Latest PAGASA Forecast Video 📺</h2>
  <div id="pagasa-video">
    <p>Loading latest PAGASA forecast video...</p>
  </div>

  <!-- Hotline Marquee -->
  <div id="hotline">
    <span>📞 HOTLINES — MDRRMO: 09186244564 | 🚒 BUMBERO: 09234424945 | 👮 PULIS: 09985985764 | 🏛 LGU PAGBILAO: (042) 797-0937</span>
  </div>

  <script>
  const OWM_KEY = "d77dbc9c66952dae67f86c58ab653dec";
  const TOMTOM_KEY = "AnWOBls5vLcwsWYRDnxX8Qf2UKPKHkHb";
  const YT_KEY = "AIzaSyAdfwN8_02GUGXTW-cnICzYvWYt1etG4JM";
  const CHANNEL_ID = "UC0s0vJ4ZjDCyDJVZle14RTA"; // Official PAGASA channel

  const PAGBILAO_LAT = 13.9714, PAGBILAO_LON = 121.6869;

  const coastalBarangays = ["Bantigue", "Pinagbayanan", "Daungan (Poblacion)", "Polo Iba.", "Polo Ila."];

  const barangays = [
    { name: "Añato", lat: 14.0042, lon: 121.6572 },
    { name: "Alupaye", lat: 13.9473, lon: 121.6697 },
    { name: "Antipolo", lat: 13.9868, lon: 121.6648 },
    { name: "Bagumbungan Iba.", lat: 13.9995, lon: 121.6894 },
    { name: "Bagumbungan Ila.", lat: 14.0257, lon: 121.6942 },
    { name: "Bantigue", lat: 13.9396, lon: 121.6944 },
    { name: "Bigo", lat: 13.9948, lon: 121.6485 },
    { name: "Binahaan", lat: 13.9898, lon: 121.7579 },
    { name: "Bukal", lat: 13.9728, lon: 121.6800 },
    { name: "Castillo (Poblacion)", lat: 13.9711, lon: 121.6831 },
    { name: "Daungan (Poblacion)", lat: 13.9683, lon: 121.6888 },
    { name: "Del Carmen (Poblacion)", lat: 13.9685, lon: 121.6856 },
    { name: "Ikirin", lat: 13.9872, lon: 121.6900 },
    { name: "Malicboy Kan.", lat: 13.9689, lon: 121.7685 },
    { name: "Malicboy Sil.", lat: 13.9802, lon: 121.7908 },
    { name: "Mapagong", lat: 13.9679, lon: 121.6798 },
    { name: "Mayhay", lat: 13.9771, lon: 121.6842 },
    { name: "Palsabangon Iba.", lat: 13.9893, lon: 121.7371 },
    { name: "Palsabangon Ila.", lat: 14.0211, lon: 121.7242 },
    { name: "Parang (Poblacion)", lat: 13.9710, lon: 121.6897 },
    { name: "Pinagbayanan", lat: 13.9690, lon: 121.7016 },
    { name: "Polo Iba.", lat: 13.9055, lon: 121.7496 },
    { name: "Polo Ila.", lat: 13.9313, lon: 121.7753 },
    { name: "Sta. Catalina (Poblacion)", lat: 13.9711, lon: 121.6868 },
    { name: "Talipan", lat: 13.9628, lon: 121.6537 },
    { name: "Tambak (Poblacion)", lat: 13.9729, lon: 121.6884 },
    { name: "Tukalan", lat: 14.0063, lon: 121.6754 }
  ];

  async function fetchWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OWM_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.cod === 200) {
        return `
          <p>🌡 ${data.main.temp}°C (feels like ${data.main.feels_like}°C)</p>
          <p>💧 Humidity: ${data.main.humidity}%</p>
          <p>💨 Wind: ${data.wind.speed} m/s</p>
          <p>☁️ Clouds: ${data.clouds.all}%</p>
          <p>🌧 Rain: ${(data.rain ? data.rain["1h"] : 0)} mm (1h)</p>
        `;
      } else {
        return `<p>⚠️ Weather not available</p>`;
      }
    } catch {
      return `<p>❌ Error fetching weather</p>`;
    }
  }

  async function fetchTide() {
    return `
      <p>🌊 High Tide: 1.8m at 03:20 AM</p>
      <p>🌊 Low Tide: 0.3m at 10:45 AM</p>
      <p>📊 <a href="https://www.tide-forecast.com/locations/Pagbilao/tides/latest" target="_blank">View Full Tide Chart</a></p>
    `;
  }

  async function loadSummary() {
    const weather = await fetchWeather(PAGBILAO_LAT, PAGBILAO_LON);
    const tide = await fetchTide();
    document.getElementById("summary").innerHTML = weather + tide;
  }

  async function loadWeather() {
    const container = document.getElementById("weather");
    container.innerHTML = "";
    const results = await Promise.all(barangays.map(async b => {
      const w = await fetchWeather(b.lat, b.lon);
      let tideInfo = "";
      if (coastalBarangays.includes(b.name)) {
        tideInfo = `
          <div class="tide-info">
            🌊 High Tide: 1.8m at 03:20 AM<br>
            🌊 Low Tide: 0.3m at 10:45 AM<br>
            📊 <a href="https://www.tide-forecast.com/locations/Pagbilao/tides/latest" target="_blank">View Full Tide Chart</a>
          </div>
        `;
      }
      return `<div class="barangay-card"><h3>${b.name}</h3>${w}${tideInfo}</div>`;
    }));
    container.innerHTML = results.join("");
  }

  async function loadTraffic() {
    const url = `https://api.tomtom.com/traffic/services/4/flowSegmentData/absolute/10/json?point=13.972,121.687&key=${TOMTOM_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.flowSegmentData) {
        document.getElementById("traffic").innerHTML = `
          <p>🚙 Current Speed: ${data.flowSegmentData.currentSpeed} km/h</p>
          <p>🛣 Free Flow: ${data.flowSegmentData.freeFlowSpeed} km/h</p>
        `;
      } else {
        document.getElementById("traffic").innerText = "⚠️ Traffic data unavailable.";
      }
    } catch {
      document.getElementById("traffic").innerText = "❌ Error loading traffic.";
    }
  }

  async function loadPagasaVideo() {
    try {
      let url = `https://www.googleapis.com/youtube/v3/search?key=${YT_KEY}&channelId=${CHANNEL_ID}&part=snippet&order=date&maxResults=1&type=video`;
      let res = await fetch(url);
      let data = await res.json();
      if (data.items && data.items.length > 0) {
        const video = data.items[0];
        const videoId = video.id.videoId;
        const title = video.snippet.title;
        const published = new Date(video.snippet.publishedAt).toLocaleString();
        document.getElementById("pagasa-video").innerHTML = `
          <h3>${title}</h3>
          <p>📅 Published: ${published}</p>
          <iframe width="75%" height="500"
            src="https://www.youtube.com/embed/${videoId}"
            frameborder="0" allowfullscreen>
          </iframe>
        `;
      } else {
        document.getElementById("pagasa-video").innerText = "⚠️ No recent PAGASA videos found.";
      }
    } catch {
      document.getElementById("pagasa-video").innerText = "❌ Error loading PAGASA video.";
    }
  }

  loadSummary();
  loadWeather();
  loadTraffic();
  loadPagasaVideo();
  setInterval(() => { loadSummary(); loadWeather(); }, 4 * 60 * 60 * 1000);
  </script>
</body>
</html>


